<app-headear></app-headear>

<div class="agendamentos-container">

  <h2>Meus Agendamentos</h2>

  <!-- Botão Voltar -->
  <div class="voltar-container">
    <button class="btn-voltar" (click)="voltar()">← Voltar</button>
  </div>

  <!-- Filtros -->
  <div class="filtros">
    <input type="text" placeholder="Filtrar por Banco de Leite" [(ngModel)]="filtroBanco" />
    <select [(ngModel)]="filtroStatus">
      <option value="">Todos os Status</option>
      <option value="pendente">Pendente</option>
      <option value="aceito">Aceito</option>
      <option value="recusado">Recusado</option>
      <option value="reagendamento">Reagendamento Solicitado</option>
    </select>
    <select [(ngModel)]="ordenarData">
      <option value="recentes">Mais recentes</option>
      <option value="antigas">Mais antigas</option>
    </select>
  </div>

  <!-- Lista de Cards -->
  <div class="cards">
    <div class="card-agendamento" *ngFor="let agendamento of agendamentosFiltrados()"
         [ngClass]="{
           'pendente': agendamento.status.toLowerCase() === 'pendente',
           'aceito': agendamento.status.toLowerCase() === 'aceito',
           'recusado': agendamento.status.toLowerCase() === 'recusado',
           'reagendamento': agendamento.status.toLowerCase().includes('reagendamento solicitado')
         }">

      <h3>{{ agendamento.nome_doadora }}</h3>
      <p><strong>Status:</strong> {{ agendamento.status }}</p>
      <p><strong>Data:</strong> {{ formatarData(agendamento.data_doacao) }}</p>
      <p><strong>Ponto de Coleta / Banco de Leite:</strong> {{ agendamento.nome_banco_leite }}</p>
      <p><strong>ML:</strong> {{ agendamento.quantidade_ml }} ml</p>
      <p><strong>Endereço:</strong> {{ agendamento.rua || '-' }}, {{ agendamento.numero || '-' }}, {{ agendamento.bairro || '-' }}</p>

      <!-- Botões de Ação -->
      <div class="acoes-card">
        <!-- Sempre pode cancelar/excluir -->
        <button class="acao-btn cancelar" (click)="cancelarAgendamento(agendamento.id)">Excluir</button>

        <!-- Aceitar Reagendamento -->
        <button *ngIf="mostrarAceitar(agendamento.status)"
                class="acao-btn aceitar"
                (click)="aceitarReagendamento(agendamento.id)">
          Aceitar Reagendamento
        </button>

        <!-- Recusar Reagendamento -->
        <button *ngIf="mostrarRecusar(agendamento.status)"
                class="acao-btn recusar"
                (click)="recusarReagendamento(agendamento.id)">
          Recusar Reagendamento
        </button>

        <!-- Reagendar (editar data) -->
        <div class="reagendamento-card" *ngIf="mostrarReagendar(agendamento.status)">
          <input type="datetime-local" [(ngModel)]="novaDataReagendamento[agendamento.id]" />
          <button class="acao-btn reagendar" (click)="solicitarReagendamento(agendamento.id)">Reagendar</button>
        </div>
      </div>

    </div>
  </div>

</div>
