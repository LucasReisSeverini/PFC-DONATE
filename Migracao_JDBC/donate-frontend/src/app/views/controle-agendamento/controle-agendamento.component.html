<app-headear></app-headear>

<div class="agendamentos-container">
  <h2>Controle de Agendamentos</h2>

  <!-- Bot√µes de a√ß√£o -->
  <div class="agendamentos-header">
    <button class="btn-voltar" (click)="voltarHome()">‚Üê Voltar</button>
    <button class="btn-proximos" (click)="agendamentosProximos()">üìç Agendamentos pr√≥ximos</button>
    <button class="btn-todos" (click)="mostrarTodosAgendamentos()">Mostrar todos</button>
  </div>

  <!-- Filtros -->
  <div class="filtros">
    <input type="text" placeholder="Filtrar por Doadora" [(ngModel)]="filtroDoadora" />
    <input type="text" placeholder="Filtrar por Ponto de Coleta/Banco" [(ngModel)]="filtroBanco" />
    <label>Data Inicial:</label>
    <input type="date" [(ngModel)]="dataInicial" />
    <label>Data Final:</label>
    <input type="date" [(ngModel)]="dataFinal" />
    <select [(ngModel)]="filtroStatus">
      <option value="">Todos os Status</option>
      <option value="Pendente">Pendente</option>
      <option value="Aceito">Aceito</option>
      <option value="Recusado">Recusado</option>
      <option value="Reagendamento Solicitado pelo Profissional de Sa√∫de">Reagendamento Solicitado pelo Profissional de Sa√∫de</option>
      <option value="Reagendamento Solicitado pela Doadora">Reagendamento Solicitado pela Doadora</option>
    </select>
    <select [(ngModel)]="ordenarData">
      <option value="recentes">Mais recentes</option>
      <option value="antigas">Mais antigas</option>
    </select>
  </div>

  <!-- Cards de agendamentos -->
  <div class="cards">
    <div class="card-agendamento" *ngFor="let agendamento of agendamentosFiltrados()"
         [ngClass]="getStatusClass(agendamento.status)">
      <h3>{{ agendamento.nome_doadora }}</h3>
      <p><strong>Status:</strong> {{ agendamento.status }}</p>
      <p><strong>Data:</strong> {{ formatarData(agendamento.data_agendamento) }}</p>
      <p><strong>Ponto de Coleta / Banco de Leite:</strong> {{ agendamento.bancoDeLeite }}</p>
      <p><strong>ML:</strong> {{ agendamento.quantidade_ml }} ml</p>
      <p><strong>Endere√ßo:</strong> {{ agendamento.rua || '-' }}, {{ agendamento.numero || '-' }}, {{ agendamento.bairro || '-' }}</p>

      <!-- A√ß√µes somente se n√£o estiver aceito, recusado ou reagendado -->
      <div class="acoes-card" *ngIf="agendamento.status !== 'Aceito' && agendamento.status !== 'Recusado' && !agendamento.status.includes('Reagendamento')">
        <button class="acao-btn aceitar" (click)="aceitar(agendamento.id)">Aceitar</button>
        <button class="acao-btn recusar" (click)="recusar(agendamento.id)">Recusar</button>
      </div>

      <div class="reagendamento-card" *ngIf="agendamento.status !== 'Aceito' && agendamento.status !== 'Recusado' && !agendamento.status.includes('Reagendamento')">
        <input type="datetime-local" [(ngModel)]="novaDataReagendamento[agendamento.id]" />
        <button class="acao-btn reagendar" (click)="reagendar(agendamento.id)">Reagendar</button>
      </div>
    </div>
  </div>
</div>
