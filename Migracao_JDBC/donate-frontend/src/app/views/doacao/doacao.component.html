<app-headear></app-headear>

<div class="doacao-container">

  <!-- Bot√£o voltar no topo -->
  <button type="button" class="btn-voltar" (click)="voltarParaPainel()">
    ‚Üê Voltar
  </button>

  <h1>Agendar Doa√ß√£o</h1>

  <form [formGroup]="doacaoForm" (ngSubmit)="agendarDoacao()">

    <!-- Bot√£o usar banco mais pr√≥ximo -->
    <button type="button" class="btn-accent" (click)="usarBancoMaisProximo()">
      üìç Usar banco de leite mais pr√≥ximo
    </button>

    <!-- Banco de leite -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Banco de leite</mat-label>
      <mat-select formControlName="id_bancos_de_leite">
        <mat-option *ngFor="let banco of bancosDeLeite" [value]="banco.id">
          {{ banco.nome }}
        </mat-option>
      </mat-select>
      <mat-error *ngIf="doacaoForm.get('id_bancos_de_leite')?.hasError('required') && doacaoForm.get('id_bancos_de_leite')?.touched">
        Selecione um banco de leite.
      </mat-error>
    </mat-form-field>

    <!-- Quantidade -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Quantidade (ml)</mat-label>
      <input matInput type="number" formControlName="quantidade_ml" placeholder="Ex: 250" />
      <mat-error *ngIf="doacaoForm.get('quantidade_ml')?.hasError('required') && doacaoForm.get('quantidade_ml')?.touched">
        Informe a quantidade.
      </mat-error>
      <mat-error *ngIf="doacaoForm.get('quantidade_ml')?.hasError('min') && doacaoForm.get('quantidade_ml')?.touched">
        A quantidade deve ser maior que zero.
      </mat-error>
    </mat-form-field>

    <!-- Logradouro -->
    <mat-form-field appearance="fill" class="full-width">
      <mat-label>Logradouro</mat-label>
      <input matInput type="text" formControlName="rua" placeholder="Digite o logradouro" />
      <mat-error *ngIf="doacaoForm.get('rua')?.hasError('required') && doacaoForm.get('rua')?.touched">
        Informe o Logradouro.
      </mat-error>
    </mat-form-field>

    <!-- N√∫mero e Bairro lado a lado -->
    <div class="endereco-container">
      <mat-form-field appearance="fill">
        <mat-label>N√∫mero</mat-label>
        <input matInput type="text" formControlName="numero" placeholder="Digite o n√∫mero" />
        <mat-error *ngIf="doacaoForm.get('numero')?.hasError('required') && doacaoForm.get('numero')?.touched">
          Informe o n√∫mero.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Bairro</mat-label>
        <input matInput type="text" formControlName="bairro" placeholder="Digite o bairro" />
        <mat-error *ngIf="doacaoForm.get('bairro')?.hasError('required') && doacaoForm.get('bairro')?.touched">
          Informe o bairro.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Data e Hora -->
    <div class="data-horario">
      <!-- Calend√°rio -->
      <div class="calendario-container">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Data da doa√ß√£o</mat-label>
          <input matInput type="text" readonly
                 [value]="dataSelecionada"
                 (click)="toggleCalendario()"
                 placeholder="DD/MM/AAAA">
          <button matSuffix type="button" (click)="toggleCalendario()">üìÖ</button>
          <mat-error *ngIf="doacaoForm.get('data_doacao')?.hasError('required') && doacaoForm.get('data_doacao')?.touched">
            Selecione uma data.
          </mat-error>
        </mat-form-field>

        <div class="calendario" *ngIf="mostrarCalendario">
          <div class="calendario-header">
            <button type="button" (click)="mesAnterior()">‚Üê</button>
            <span>{{ meses[mesAtual] }} {{ anoAtual }}</span>
            <button type="button" (click)="mesSeguinte()">‚Üí</button>
          </div>

          <div class="dias-semana">
            <div *ngFor="let dia of diasDaSemana" class="dia-semana">{{ dia }}</div>
          </div>

          <div class="dias-mes">
            <div *ngFor="let dia of diasDoMes"
                 class="dia-mes"
                 [class.selecionado]="dia && dataSelecionada === formatarDataExibicao(dia, mesAtual, anoAtual)"
                 (click)="dia ? selecionarData(dia) : null">
              {{ dia || '' }}
            </div>
          </div>
        </div>
      </div>

      <!-- Hora -->
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Hora da doa√ß√£o</mat-label>
        <input matInput type="time" formControlName="hora_doacao" />
        <mat-error *ngIf="doacaoForm.get('hora_doacao')?.hasError('required') && doacaoForm.get('hora_doacao')?.touched">
          Informe a hora da doa√ß√£o.
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Bot√£o de enviar -->
    <button type="submit" class="btn-submit">Agendar</button>
  </form>
</div>
